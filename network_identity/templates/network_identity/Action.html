{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
<div class="container">
    <div class="row">
      <div class="col-sm-12 border border-dark text-white rounded" style='background-color: #455A64;'>
        <h2> Action </h2>
      </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
      <div class="col-sm-12 border border-dark text-white rounded mb-1" style='background-color: #607D8B;'>
        <p>
            {% if player.given_type == 1 %}
            You are player <b style='color: #B3E5FC'> {{ player.name }}</b>. Your internal symbol is <b style='color: #B3E5FC'>Circle</b> and your external symbol is <b style='color: #B3E5FC'>Circle</b>

            {% elif player.given_type == 2 %}
            You are player <b style='color: #B3E5FC'> {{ player.name }}</b>. Your internal symbol is <b style='color: #B3E5FC'>Circle</b> and your external symbol is <b style='color: #B3E5FC'>Triangle</b>

            {% elif player.given_type == 3 %}
            You are player <b style='color: #B3E5FC'> {{ player.name }}</b>. Your internal symbol is <b style='color: #B3E5FC'>Triangle</b> and your external symbol is <b style='color: #B3E5FC'>Circle</b>

            {% else %}
            You are player <b style='color: #B3E5FC'> {{ player.name }}</b>. Your internal symbol is <b style='color: #B3E5FC'>Triangle</b> and your external symbol is <b style='color: #B3E5FC'>Triangle</b>
            {% endif %}
        </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-3 border border-dark text-white rounded p-3 mb-1" style='background-color: #607D8B;'>
        <h6>Please, choose an action:</h6>
          <br>
        <div>
            <button name="action" value="True" class="btn button1 btn-large"> Arriba </button>
            <br><br>
            <button name="action" value="False" class="btn button2 btn-large"> Abajo </button>
        </div>
      </div>
      <div class="col-sm-9 border border-dark rounded p-3 mb-1" style='background-color: #F8F8FF;'>
        <div id="cy"></div>
            <div class="container ">
                <div class="row">

                </div>
            </div>
      </div>
    </div>
</div>


{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.1.0/cytoscape.js"></script>
    <script>
        var jsonnet = JSON.parse('{{group.network_data|safe}}');
        var player_id = {{ player.name }};
        console.log(jsonnet);
        var cy = window.cy = cytoscape({
            container: document.getElementById('cy'),

        });

        // Add isMine = 'yes' to all player's node and edges
        jsonnet.elements = jsonnet.elements.map(
            function(value) {
                if ( (value.group === 'nodes' && value.data.name == player_id) ||
                     (value.group === 'edges' && (value.data.source == player_id || value.data.target == player_id))
                ) {
                    value.data.isMine = 'yes'
                }
                else {
                    value.data.isMine = 'no'
                }

                    //                 if (value.group === 'edges' && value.data.source == player_id) {
                    //     value.data.linkStyle = 'source'
                    // }
                return value
            });

        console.log(jsonnet)
        cy.json(jsonnet);

        var layout = cy.layout({name: 'circle'});

        layout.run();
        //cy.center('node[isMine="yes"]');
        cy.panBy('node[isMine="yes"]');
        //cy.fit();
        // Centra en el nodo pero no con los dem√°s al rededor

        cy.style()
            .selector('edge')
            .style('line-color', '#607D8B')
            .style("target-arrow-shape", "vee")
            .style("target-arrow-color", "#607D8B")
            .style("curve-style", 'bezier')
            .style('width', '2')


            .selector('edge[isMine="yes"]')
            .style('line-color', '#455A64')
            .style("target-arrow-color", "#455A64")
            .style('width', '4')


         //   .selector('edge[linkStyle="source"]')
         //   .style('line-color', 'green')

            // .selector('node[attribute=0]')
            // .style('shape', 'circle')

            .selector('node[attribute=1]')
            .style('shape', 'triangle')

            .selector('node[isMine="yes"]')
            .style('background-color', '#B3E5FC')
            .style('border-width', '5')
            .style('border-color', '#455A64')


            .selector('node[isMine="no"]')
            .style('background-color', '#FAFAFA')
            .style('border-width', '2')
            .style('border-color', '#607D8B')


            .update() // update the elements in the graph with the new style
        ;

        cy.userZoomingEnabled(false);
        cy.autoungrabify(true);
    </script>
{% endblock %}

{% block styles %}
    <style type="text/css">
        #cy {
            width: 100%;
            height: 500px;
            display: block;
        }
    .button1 {
        background-color: #B3E5FC;
        color: #000000;
        border: 2px solid #3E2723
    }
    .button1:hover {
        background-color: #8E24AA;
        color: #ffffff;
    }
    .button1:active {
      background-color: #3e8e41;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }
    .button2 {
        background-color: #B3E5FC;
        color: #000000;
        border: 2px solid #3E2723
    }
    .button2:hover {
        background-color: #43A047;
        color: #ffffff;
    }
    .button2:active {
      background-color: #3e8e41;
      box-shadow: 0 5px #666;
      transform: translateY(4px);
    }


    </style>

{% endblock %}
