{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
<div class="container">
    <div class="row">
      <div class="col-sm-12 border border-dark text-white rounded" id="upper">
          <h2>Group Choice</h2>
        <h5>
            The initial groups are <b id='lower'> {{ group.total_init_circles }} &#9679</b> and <b id='lower'>
            {{ group.total_init_triangles }} &#9650</b>.
            <br>
            {% if player.given_type == 1 %}
            - Your group is <b id='lower'>&#9679</b> and your appearance <b id='lower'>&#9711</b>.

            {% elif player.given_type == 4 %}
            - Your group is <b id='lower'>&#9650</b> and your appearance <b id='lower'>&#9651</b>.
            {% endif %}
        </h5>

      </div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
      <div class="col-sm-12 border border-dark text-white rounded mb-1" id="middle">
          <br>
        <p>
            <i>For this round</i>, choose if you want to change to the other group or to stay in your group:
        </p>
        <div>
            {% if player.treat == 1 %}
                {% if player.given_type == 1 %}
                <button name="chosen_type" value="4" class="btn button btn-large"> Change to &#9650 </button>
                <br><br>
                <button name="chosen_type" value="1" class="btn button btn-large"> Stay as &#9679 </button>
                {% else %}
                <button name="chosen_type" value="1" class="btn button btn-large"> Change to &#9679 </button>
                <br><br>
                <button name="chosen_type" value="4" class="btn button btn-large"> Stay as &#9650 </button>
                {% endif %}
            {% else %}
                {% if player.given_type == 1 %}
                <button name="chosen_type" value="2" class="btn button btn-large"> Change to &#9650 </button>
                <br><br>
                <button name="chosen_type" value="1" class="btn button btn-large"> Stay as &#9679 </button>
                {% else %}
                <button name="chosen_type" value="3" class="btn button btn-large"> Change to &#9679 </button>
                <br><br>
                <button name="chosen_type" value="4" class="btn button btn-large"> Stay as &#9650 </button>
                {% endif %}
            {% endif %}
        </div>
          <br><br>
      </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.1.0/cytoscape.js"></script>
    <script>
        var jsonnet = JSON.parse('{{group.network_data|safe}}');
        var player_id = {{ player.name }};
        console.log(jsonnet);
        var cy = window.cy = cytoscape({
            container: document.getElementById('cy'),

        });

        // Add isMine = 'yes' to all player's node and edges
        jsonnet.elements = jsonnet.elements.map(
            function(value) {
                if ( value.group === 'nodes' && value.data.name == player_id)
                {
                    value.data.isMine = 'yes'
                }
                else {
                    value.data.isMine = 'no'
                }
                if ( (value.group === 'nodes' && value.data.name == 1) || (value.group === 'nodes' && value.data.name == 2) ||
                        (value.group === 'nodes' && value.data.name == 3) || (value.group === 'nodes' && value.data.name == 7) ||
                        (value.group === 'nodes' && value.data.name == 6)
                ) {
                    value.data.vertPos = 'top'
                }
                else {
                    value.data.vertPos = 'bottom'
                }
                if ( (value.group === 'nodes' && value.data.name == 1) || (value.group === 'nodes' && value.data.name == 2) ||
                        (value.group === 'nodes' && value.data.name == 3) || (value.group === 'nodes' && value.data.name == 4)
                ) {
                    value.data.horPos = 'right'
                }
                else {
                    value.data.horPos = 'left'
                }
                return value
            });

        console.log(jsonnet)
        cy.json(jsonnet);

        var layout = cy.layout({name: 'circle'});

        layout.run();
        //cy.center('node[isMine="yes"]');
        cy.panBy('node[isMine="yes"]');
        //cy.fit();
        // Centra en el nodo pero no con los dem√°s al rededor

        cy.style()
            // NODES ==============================================
            .selector('node')
            .style('padding-relative-to', 'width')
            // Node Labels: Top
            .selector('node[vertPos="top"]')
            .style('text-valign','top')
            // Node Labels: Bottom
            .selector('node[vertPos="bottom"]')
            .style('text-valign','bottom')
            // Node Labels: Right
            .selector('node[horPos="right"]')
            .style('text-halign','right')
            // Node Labels: Left
            .selector('node[horPos="left"]')
            .style('text-halign','left')
            // Nodes: type == 1
            .selector('node[given=1]')
            .style('shape', 'ellipse')
            .style('background-image', 'url("{% static "network_identity/circle.png" %}")')
            .style('background-image-opacity', '0.7')
            .style('background-fit', 'contain')
            // Nodes: type == 2
            // .selector('node[shape=2]')
            // .style('shape', 'ellipse')
            // .style('background-image', 'url("{% static "network_identity/triangle.png" %}")')
            // .style('background-image-opacity', '0.7')
            // .style('background-fit', 'contain')
            // // Nodes: type == 3
            // .selector('node[shape=3]')
            // .style('shape', 'triangle')
            // .style('background-image', 'url("{% static "network_identity/circle.png" %}")')
            // .style('background-image-opacity', '0.7')
            // .style('background-fit', 'contain')
            // Nodes: type == 4
            .selector('node[given=4]')
            .style('shape', 'triangle')
            .style('background-image', 'url("{% static "network_identity/triangle.png" %}")')
            .style('background-image-opacity', '0.7')
            .style('background-fit', 'contain')
            // My Node
            .selector('node[isMine="yes"]')
            .style('width', '35px')
            .style('height', '35px')
            .style('background-color', '#B3E5FC')
            .style('border-width', '4')
            .style('border-color', '#455A64')
            .style('font-size','25pt')
            .style('color','#455A64')
            // NOT My Node
            .selector('node[isMine="no"]')
            .style('border-width', '2')
            .style('border-color', '#607D8B')
            .style('background-color', '#FAFAFA')
            .style('font-size','15')
            .style('color','#607D8B')
            // ====================================================
            .update() // update the elements in the graph with the new style
        ;

        cy.userZoomingEnabled(false);
        cy.autoungrabify(true);
    </script>
{% endblock %}

{% block styles %}
    <style type="text/css">
        #cy {
            width: 100%;
            height: 500px;
            display: block;
        }

        #white{
            color: #ffffff;
        }

        .center {
            text-align: center;
        }
        .button {
            background-color: #000000;
            color: #EEE8AA;
            border: 2px solid #EEE8AA
        }
        .button:hover {
            background-color: #EEE8AA;
            color: #000000;
            border: 2px solid #000000
        }
        #upper{
            background-color: #000000;
        }
        #middle{
            background-color: #424242;
        }
        #lower{
            color: #EEE8AA
        }
        #network{
            background-color: #ffffff;
        }
    </style>
{% endblock %}
